"use strict";(self.webpackChunktest=self.webpackChunktest||[]).push([[466],{6281:(e,o,i)=>{i.r(o),i.d(o,{assets:()=>a,contentTitle:()=>r,default:()=>h,frontMatter:()=>t,metadata:()=>d,toc:()=>l});var n=i(4848),s=i(8453);const t={displayed_sidebar:"mySidebar"},r="Migration guide for v2.x",d={id:"dev/migration-guide-v2",title:"Migration guide for v2.x",description:"Introduction",source:"@site/docs/dev/migration-guide-v2.md",sourceDirName:"dev",slug:"/dev/migration-guide-v2",permalink:"/dev/migration-guide-v2",draft:!1,unlisted:!1,editUrl:"https://github.com/foodcoopshop/foodcoopshop.github.io/edit/main/docs/dev/migration-guide-v2.md",tags:[],version:"current",lastUpdatedAt:1710840101e3,frontMatter:{displayed_sidebar:"mySidebar"},sidebar:"mySidebar"},a={},l=[{value:"Introduction",id:"introduction",level:2},{value:"FCS v2.6.x to FCS v2.7.x",id:"fcs-v26x-to-fcs-v27x",level:2},{value:"FCS v2.5.x to FCS v2.6.x",id:"fcs-v25x-to-fcs-v26x",level:2},{value:"FCS v2.4.x to FCS v2.5.x",id:"fcs-v24x-to-fcs-v25x",level:2},{value:"FCS v2.3.x to FCS v2.4.x",id:"fcs-v23x-to-fcs-v24x",level:2},{value:"FCS v2.2.x to FCS v2.3.x",id:"fcs-v22x-to-fcs-v23x",level:2},{value:"FCS v2.1.x to FCS v2.2.x",id:"fcs-v21x-to-fcs-v22x",level:2},{value:"FCS v2.0.x to FCS v2.1.x",id:"fcs-v20x-to-fcs-v21x",level:2},{value:"FCS v1.5.x to FCS v2.0.x",id:"fcs-v15x-to-fcs-v20x",level:2},{value:"If you have questions, please first check existing github support issues",id:"if-you-have-questions-please-first-check-existing-github-support-issues",level:2}];function c(e){const o={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.header,{children:(0,n.jsx)(o.h1,{id:"migration-guide-for-v2x",children:"Migration guide for v2.x"})}),"\n",(0,n.jsx)(o.h2,{id:"introduction",children:"Introduction"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsx)(o.li,{children:(0,n.jsx)(o.strong,{children:"Always make a database and file backup before updating your installation!"})}),"\n",(0,n.jsx)(o.li,{children:"There is no automatic update tool, updating FoodCoopShop needs to be done manually. But it's not too hard and this migration guide helps you."}),"\n",(0,n.jsx)(o.li,{children:"Updating from 2.x to 2.y are possible. E.g. from 2.1.x to 2.6.x directly."}),"\n"]}),"\n",(0,n.jsx)(o.h2,{id:"fcs-v26x-to-fcs-v27x",children:"FCS v2.6.x to FCS v2.7.x"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsx)(o.li,{children:"replace source code => see bottom of page"}),"\n",(0,n.jsx)(o.li,{children:"execute migrations => see bottom of page"}),"\n"]}),"\n",(0,n.jsx)(o.h2,{id:"fcs-v25x-to-fcs-v26x",children:"FCS v2.5.x to FCS v2.6.x"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsx)(o.li,{children:"replace source code => see bottom of page"}),"\n",(0,n.jsx)(o.li,{children:"execute migrations => see bottom of page"}),"\n",(0,n.jsx)(o.li,{children:"legacy password hashing (introduced in v2.3) method was removed. If you don't update regularly, your users can't login anymore and might need to request a new password. You can now safely remove app.cookieKey."}),"\n"]}),"\n",(0,n.jsx)(o.h2,{id:"fcs-v24x-to-fcs-v25x",children:"FCS v2.4.x to FCS v2.5.x"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsx)(o.li,{children:"replace source code => see bottom of page"}),"\n",(0,n.jsx)(o.li,{children:"execute migrations => see bottom of page"}),"\n",(0,n.jsx)(o.li,{children:"PHP >= 7.2"}),"\n"]}),"\n",(0,n.jsx)(o.h2,{id:"fcs-v23x-to-fcs-v24x",children:"FCS v2.3.x to FCS v2.4.x"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsx)(o.li,{children:"replace source code => see bottom of page"}),"\n",(0,n.jsx)(o.li,{children:"execute migrations => see bottom of page"}),"\n",(0,n.jsx)(o.li,{children:"after the migrations you can remove app.deliveryDayDelta, app.sendOrderListsWeekday and app.registrationNotificationEmails (see documentation info in app_config.php and custom_config.default.php)"}),"\n",(0,n.jsxs)(o.li,{children:["If you want to use the new single sign on for discourse forums, set ",(0,n.jsx)(o.code,{children:"app.discourseSsoEnabled"})," to ",(0,n.jsx)(o.code,{children:"true"})," and add a ",(0,n.jsx)(o.code,{children:"app.discourseSsoSecret"}),". ",(0,n.jsx)(o.a,{href:"/diverses/sso-fuer-discourse-forum",children:"Anleitung auf Deutsch"})]}),"\n"]}),"\n",(0,n.jsx)(o.h2,{id:"fcs-v22x-to-fcs-v23x",children:"FCS v2.2.x to FCS v2.3.x"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsx)(o.li,{children:"replace source code => see bottom of page"}),"\n",(0,n.jsx)(o.li,{children:"execute migrations => see bottom of page"}),"\n",(0,n.jsxs)(o.li,{children:["Enable the ",(0,n.jsx)(o.a,{href:"/dev/cronjobs",children:"new cronjob handling"})]}),"\n"]}),"\n",(0,n.jsx)(o.h2,{id:"fcs-v21x-to-fcs-v22x",children:"FCS v2.1.x to FCS v2.2.x"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsx)(o.li,{children:"replace source code => see bottom of page"}),"\n",(0,n.jsx)(o.li,{children:"execute migrations => see bottom of page"}),"\n",(0,n.jsx)(o.li,{children:"If the migrations fail, remove all migrations that have not run yet from table phinxlog and run them again."}),"\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.strong,{children:"20180720130810_RemoveOrdersTable"})," can take some time, depending on size of table fcs_order_detail so be sure that there is no execution timeout!"]}),"\n",(0,n.jsxs)(o.li,{children:["Sometimes the pickup_day in table fcs_order_detail is not set correctly. If this is the case with your installation, please remove 20180720130810_RemoveOrdersTable from table phinxlog, then edit the migration and comment ",(0,n.jsx)(o.a,{href:"https://github.com/foodcoopshop/foodcoopshop/blob/351d23b295297c91aba0a0e44107ea58609f7d95/config/Migrations/20180720130810_RemoveOrdersTable.php#L77-L84",children:"these lines"}),", run the migration, then remove the migration from table phinxlog, comment ",(0,n.jsx)(o.a,{href:"https://github.com/foodcoopshop/foodcoopshop/blob/351d23b295297c91aba0a0e44107ea58609f7d95/config/Migrations/20180720130810_RemoveOrdersTable.php#L13-L75",children:"these lines"})," and run the migration again."]}),"\n",(0,n.jsx)(o.li,{children:"At some configurations the migrations fail the first time when they are called. Just call them a second time, then it should work."}),"\n",(0,n.jsxs)(o.li,{children:['activate new cronjob "PickupReminder", see bottom of ',(0,n.jsx)(o.a,{href:"/dev/installation-guide",children:"installation guide"})]}),"\n",(0,n.jsxs)(o.li,{children:["add the configuration ",(0,n.jsx)(o.code,{children:"app.dateOfFirstSendInvoiceCronjobWithPickupDayUpdate"})," to your custom_config.php and change the date when your SendInvoices cronjob will first run with this update. Example: you installed v2.2 or later on 3rd April 2019: value is 2019-04-11 (11 is default day of SendInvoices)"]}),"\n",(0,n.jsxs)(o.li,{children:["if you have problems with the update, ",(0,n.jsx)(o.a,{href:"https://github.com/foodcoopshop/foodcoopshop/issues/new",children:"please create a new issue"})]}),"\n"]}),"\n",(0,n.jsx)(o.h2,{id:"fcs-v20x-to-fcs-v21x",children:"FCS v2.0.x to FCS v2.1.x"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsx)(o.li,{children:"replace source code => see bottom of page"}),"\n",(0,n.jsx)(o.li,{children:"execute migrations => see bottom of page"}),"\n",(0,n.jsxs)(o.li,{children:["if you have problems with the update, ",(0,n.jsx)(o.a,{href:"https://github.com/foodcoopshop/foodcoopshop/issues/new",children:"please create a new issue"})]}),"\n"]}),"\n",(0,n.jsx)(o.h2,{id:"fcs-v15x-to-fcs-v20x",children:"FCS v1.5.x to FCS v2.0.x"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:["FCS v2.0 uses CakePHP3 which is ",(0,n.jsx)(o.strong,{children:"mostly incompatible"})," to CakePHP2"]}),"\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.strong,{children:"therefore you can only update to v2.0 from v1.5!"}),", so if you are working on v1.x and you want to update to v2.0, first update to 1.5!"]}),"\n",(0,n.jsxs)(o.li,{children:["you can download v1.5 ",(0,n.jsx)(o.a,{href:"https://github.com/foodcoopshop/foodcoopshop/releases/download/v1.5.0/FoodCoopShop-v1.5.0.zip",children:"here"})]}),"\n",(0,n.jsx)(o.li,{children:"replace source code => see bottom of page"}),"\n",(0,n.jsxs)(o.li,{children:["use the new structure of config files (rename custom.config.php to custom_config.php), follow the steps in the updated ",(0,n.jsx)(o.a,{href:"/dev/installation-guide",children:"Installation guide"})]}),"\n",(0,n.jsxs)(o.li,{children:["be aware that the content of the config file changed in syntax! renaming the file to custom_config.php ",(0,n.jsx)(o.strong,{children:"is not enough!"})]}),"\n",(0,n.jsx)(o.li,{children:"add the following code to the top of your /webroot/.htaccess in order to redirect some urls from v1.x"}),"\n"]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{children:"RewriteRule ^admin/order_details(.*)? /admin/order-details$1 [L,R=301]\nRewriteRule ^admin/action_logs(.*)? /admin/action-logs$1 [L,R=301]\nRewriteRule ^admin/blog_posts(.*)? /admin/blog-posts$1 [L,R=301]\nRewriteRule ^network/sync_domains(.*)? /network/sync-domains$1 [L,R=301]\nRewriteRule ^admin/(.*)/index/(.+)\\:(.+)/(.+)\\:(.+)/(.+)\\:(.+)/(.+)\\:(.+)/(.+)\\:(.+) /admin/$1/index/?$2=$3&$4=$5&$6=$7&$8=$9&$10=$11 [L,R=301]\nRewriteRule ^admin/(.*)/index/(.+)\\:(.+)/(.+)\\:(.+)/(.+)\\:(.+)/(.+)\\:(.+) /admin/$1/index/?$2=$3&$4=$5&$6=$7&$8=$9 [L,R=301]\nRewriteRule ^admin/(.*)/index/(.+)\\:(.+)/(.+)\\:(.+)/(.+)\\:(.+) /admin/$1/index/?$2=$3&$4=$5&$6=$7 [L,R=301]\nRewriteRule ^admin/(.*)/index/(.+)\\:(.+)/(.+)\\:(.+) /admin/$1/index/?$2=$3&$4=$5 [L,R=301]\nRewriteRule ^admin/(.*)/index/(.+)\\:(.+) /admin/$1/index/?$2=$3 [L,R=301]\n"})}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsx)(o.li,{children:"run migrations => see bottom of page"}),"\n"]}),"\n",(0,n.jsx)(o.h2,{id:"if-you-have-questions-please-first-check-existing-github-support-issues",children:"If you have questions, please first check existing github support issues"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsxs)(o.li,{children:[(0,n.jsx)(o.a,{href:"https://github.com/foodcoopshop/foodcoopshop/issues/330",children:"I#330"}),", ",(0,n.jsx)(o.a,{href:"https://github.com/foodcoopshop/foodcoopshop/issues/518",children:"I#518"})]}),"\n",(0,n.jsxs)(o.li,{children:["If you still have questions, ",(0,n.jsx)(o.a,{href:"https://github.com/foodcoopshop/foodcoopshop/issues/new",children:"please create a new issue"}),"."]}),"\n"]})]})}function h(e={}){const{wrapper:o}={...(0,s.R)(),...e.components};return o?(0,n.jsx)(o,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},8453:(e,o,i)=>{i.d(o,{R:()=>r,x:()=>d});var n=i(6540);const s={},t=n.createContext(s);function r(e){const o=n.useContext(t);return n.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function d(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),n.createElement(t.Provider,{value:o},e.children)}}}]);